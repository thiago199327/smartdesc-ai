<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Enterprise | SmartDesc Ai</title>
    // ==========================================
// 1. CONFIGURAÇÃO SUPABASE
// ==========================================

// --- Thiago, coloque suas chaves reais aqui quando for subir ---
const urlSupabase = 'SUA_URL_SUPABASE_AQUI'; 
const chaveSupabase = 'SUA_CHAVE_ANON_AQUI';

let clienteSupabase;

try {
    // Só tenta criar o cliente se as chaves não forem as padrão
    if(urlSupabase !== 'SUA_URL_SUPABASE_AQUI') {
        clienteSupabase = supabase.createClient(urlSupabase, chaveSupabase);
        verificarLogin();
    } else {
        console.warn("Chaves do Supabase não configuradas. O login não funcionará.");
        document.getElementById('user-display').innerText = "Modo Offline (Sem Supabase)";
    }
} catch (e) {
    console.error("Erro ao carregar Supabase:", e);
}

async function verificarLogin() {
    const { data, error } = await clienteSupabase.auth.getSession();
    if (error || !data.session) {
        window.location.href = 'login.html';
    } else {
        document.getElementById('user-display').innerText = data.session.user.email;
    }
}

async function fazerLogout() {
    if(clienteSupabase) {
        await clienteSupabase.auth.signOut();
        window.location.href = 'login.html';
    }
}

// ==========================================
// 2. CONFIGURAÇÃO IA (GEMINI)
// ==========================================

// Use o modelo 1.5-flash para garantir estabilidade agora
const API_KEY = "SUA_API_KEY_AQUI"; // Thiago, use uma variável de ambiente se puder!
const MODEL = "gemini-1.5-flash"; 
const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;

function toggleChat() {
    const box = document.getElementById('chat-box');
    box.style.display = (box.style.display === 'flex') ? 'none' : 'flex';
}

let base64Img = null;
document.getElementById('file-vision').addEventListener('change', function(e){
    const file = e.target.files[0];
    if(file){
        const r = new FileReader();
        r.onload = function(evt){
            base64Img = evt.target.result.split(',')[1];
            const img = document.getElementById('img-show');
            img.src = evt.target.result;
            img.style.display = 'block';
            document.querySelector('#preview-vision span').style.display = 'none';
        }
        r.readAsDataURL(file);
    }
});

async function callAPI(type) {
    const resDiv = document.getElementById(`res-${type}`);
    const errDiv = document.getElementById(`err-${type}`);
    
    resDiv.style.display = 'block';
    resDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
    errDiv.style.display = 'none';
    
    let contents = [];
    
    if (type === 'ads') {
        const prod = document.getElementById('prod-ads').value;
        if(!prod) {
            resDiv.style.display = 'none';
            return alert("Digite o nome do produto.");
        }
        contents = [{ parts: [{ text: `Crie um anúncio profissional para Shopee do produto: ${prod}. Foque em benefícios e use emojis.` }] }];
    } 
    else if (type === 'vision') {
        if(!base64Img) {
            resDiv.style.display = 'none';
            return alert("Selecione uma imagem primeiro.");
        }
        contents = [{ parts: [{ text: "Analise a qualidade desta imagem para um anúncio de e-commerce. Dê nota de 0 a 10 e diga o que melhorar." }, { inline_data: { mime_type: "image/jpeg", data: base64Img } }] }];
    }
    else if (type === 'finance') {
        contents = [{ parts: [{ text: "Dê 3 dicas práticas para reduzir o CAC (Custo de Aquisição de Cliente) na Shopee." }] }];
    }

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ contents: contents })
        });

        const data = await response.json();

        if(data.error) throw new Error(data.error.message);

        const textResponse = data.candidates[0].content.parts[0].text;
        resDiv.innerHTML = marked.parse(textResponse);

    } catch (error) {
        resDiv.style.display = 'none';
        errDiv.style.display = 'block';
        errDiv.innerHTML = `<strong>Erro:</strong> ${error.message}. Verifique sua API Key.`;
    }
}
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        /* RESET E CORES */
        :root {
            --primary: #0f172a; --accent: #3b82f6; --bg: #f1f5f9;
            --surface: #ffffff; --text: #334155; --border: #cbd5e1;
            --error: #ef4444; --success: #22c55e;
        }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); display: flex; height: 100vh; overflow: hidden; }

        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--primary); color: white; display: flex; flex-direction: column; padding: 25px; box-shadow: 5px 0 15px rgba(0,0,0,0.05); z-index: 10; }
        .logo { font-size: 1.4rem; font-weight: 700; display: flex; align-items: center; gap: 10px; margin-bottom: 40px; color: white; }
        .logo i { color: var(--accent); }
        .menu-item { padding: 12px 15px; color: #94a3b8; text-decoration: none; display: flex; align-items: center; gap: 12px; border-radius: 8px; margin-bottom: 5px; transition: 0.2s; font-size: 0.95rem; font-weight: 500; cursor: pointer; }
        .menu-item:hover, .menu-item.active { background: rgba(255,255,255,0.1); color: white; }
        
        /* Botão de Sair */
        .btn-logout { margin-top: auto; color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.2); }
        .btn-logout:hover { background: rgba(239, 68, 68, 0.1); color: #ffadad; }

        /* MAIN CONTENT */
        .main { flex: 1; padding: 40px; overflow-y: auto; }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .top-bar h1 { margin: 0; font-size: 1.8rem; color: var(--primary); }
        .status-badge { background: white; padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; border: 1px solid var(--border); display: flex; align-items: center; gap: 8px; }
        .dot { width: 8px; height: 8px; background: var(--success); border-radius: 50%; }
        
        .user-email-display { font-size: 0.85rem; color: #64748b; margin-right: 15px; }

        /* GRID CARDS */
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 25px; }
        .tool-card { background: var(--surface); padding: 25px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition: 0.3s; }
        .tool-card:hover { transform: translateY(-3px); border-color: var(--accent); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        
        .card-icon { width: 50px; height: 50px; background: #eff6ff; color: var(--accent); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.4rem; margin-bottom: 20px; }
        .tool-card h3 { margin: 0 0 5px 0; font-size: 1.1rem; color: var(--primary); }
        .tool-card p { margin: 0 0 20px 0; font-size: 0.9rem; color: #64748b; }

        /* INPUTS E BOTOES */
        label { display: block; font-size: 0.85rem; font-weight: 600; margin-bottom: 8px; color: var(--primary); }
        input, select { width: 100%; padding: 10px 12px; border: 1px solid var(--border); border-radius: 8px; font-family: inherit; margin-bottom: 15px; outline: none; box-sizing: border-box; }
        input:focus { border-color: var(--accent); ring: 2px solid rgba(59,130,246,0.1); }

        button.btn-run { width: 100%; padding: 12px; background: var(--primary); color: white; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px; }
        button.btn-run:hover { background: var(--accent); }
        button:disabled { opacity: 0.7; cursor: wait; }

        /* OUTPUT AREAS */
        .result-area { margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 10px; border-left: 4px solid var(--accent); font-size: 0.95rem; line-height: 1.6; display: none; }
        .error-box { background: #fef2f2; color: var(--error); border-color: var(--error); padding: 15px; border-radius: 8px; display: none; margin-top: 10px; font-size: 0.9rem; }

        /* CHAT FLOATING */
        .chat-float { position: fixed; bottom: 30px; right: 30px; z-index: 999; }
        .chat-toggle { width: 60px; height: 60px; background: var(--accent); border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; box-shadow: 0 10px 25px rgba(59,130,246,0.4); }
        .chat-box { position: absolute; bottom: 80px; right: 0; width: 340px; height: 480px; background: white; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 20px 50px rgba(0,0,0,0.1); display: none; flex-direction: column; overflow: hidden; }
        .chat-header { background: var(--primary); color: white; padding: 15px; font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
        .chat-msgs { flex: 1; padding: 15px; overflow-y: auto; background: #f8fafc; display: flex; flex-direction: column; gap: 10px; }
        .msg { padding: 10px 14px; border-radius: 12px; max-width: 85%; font-size: 0.9rem; }
        .msg.bot { background: white; border: 1px solid var(--border); align-self: flex-start; }
        .msg.user { background: var(--accent); color: white; align-self: flex-end; }
        .chat-input { padding: 15px; border-top: 1px solid var(--border); display: flex; gap: 10px; background: white; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="logo"><i class="fas fa-layer-group"></i> SmartDesc Ai</div>
    
    <div class="menu-item active">
        <i class="fas fa-chart-pie"></i> Dashboard
    </div>
    <div class="menu-item">
        <i class="fas fa-bullhorn"></i> Marketing Hub
    </div>
    <div class="menu-item">
        <i class="fas fa-file-invoice-dollar"></i> Financeiro & Ads
    </div>
    <div class="menu-item">
        <i class="fas fa-camera"></i> Vision Studio
    </div>

    <div class="menu-item btn-logout" onclick="fazerLogout()">
        <i class="fas fa-sign-out-alt"></i> Sair do Sistema
    </div>

    <div style="margin-top: 20px; font-size:0.8rem; opacity:0.6; text-align:center;">
        v 3.1 Enterprise<br>SmartDesc Solutions
    </div>
</div>

    <main class="main">
        <div class="top-bar">
            <h1>Painel de Controle</h1>
            <div style="display: flex; align-items: center;">
                <span id="user-display" class="user-email-display">Carregando usuário...</span>
                <div class="status-badge">
                    <div class="dot"></div>
                    Gemini 3 Flash Preview
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="tool-card">
                <div class="card-icon"><i class="fas fa-pen-nib"></i></div>
                <h3>Gerador de Copy</h3>
                <p>Cria textos de alta conversão para Shopee.</p>
                <label>Produto</label>
                <input type="text" id="prod-ads" placeholder="Ex: Fone Bluetooth...">
                <button class="btn-run" onclick="callAPI('ads')">
                    <i class="fas fa-bolt"></i> Gerar Anúncio
                </button>
                <div id="res-ads" class="result-area"></div>
                <div id="err-ads" class="error-box"></div>
            </div>

            <div class="tool-card">
                <div class="card-icon"><i class="fas fa-eye"></i></div>
                <h3>Estúdio Vision</h3>
                <p>Analisa qualidade de fotos de produtos.</p>
                <label>Foto do Produto</label>
                <input type="file" id="file-vision" accept="image/*">
                <div id="preview-vision" style="height:100px; background:#f1f5f9; border-radius:8px; display:flex; align-items:center; justify-content:center; margin-bottom:15px; overflow:hidden;">
                    <img id="img-show" style="max-width:100%; max-height:100%; display:none;">
                    <span style="color:#94a3b8; font-size:0.8rem;">Preview</span>
                </div>
                <button class="btn-run" onclick="callAPI('vision')">
                    <i class="fas fa-search"></i> Analisar Foto
                </button>
                <div id="res-vision" class="result-area"></div>
                <div id="err-vision" class="error-box"></div>
            </div>

            <div class="tool-card">
                <div class="card-icon"><i class="fas fa-chart-line"></i></div>
                <h3>Auditoria Financeira</h3>
                <p>Estratégias para reduzir custos (CAC).</p>
                <button class="btn-run" style="background:#1e293b; margin-top:20px;" onclick="callAPI('finance')">
                    <i class="fas fa-calculator"></i> Gerar Relatório
                </button>
                <div id="res-finance" class="result-area"></div>
                <div id="err-finance" class="error-box"></div>
            </div>
        </div>
    </main>

    <div class="chat-float">
        <div class="chat-box" id="chat-box">
            <div class="chat-header">
                <span>Suporte SmartDesc Ai</span>
                <i class="fas fa-times" style="cursor:pointer" onclick="toggleChat()"></i>
            </div>
            <div class="chat-msgs" id="chat-msgs">
                <div class="msg bot">Olá! Sou a IA da SmartDesc Ai. Como posso ajudar sua empresa hoje?</div>
            </div>
            <div class="chat-input">
                <input type="text" id="chat-txt" placeholder="Digite..." style="margin:0;" onkeypress="if(event.keyCode==13) sendChat()">
                <button style="background:var(--accent); color:white; border:none; width:40px; border-radius:8px; cursor:pointer;" onclick="sendChat()"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
        <div class="chat-toggle" onclick="toggleChat()">
            <i class="fas fa-comment-dots"></i>
        </div>
    </div>

    <script>
        // ==========================================
        // 1. CONFIGURAÇÃO SUPABASE (LOGIN/SAIR)
        // ==========================================
        
        // --- COLOQUE SUAS CHAVES AQUI ---
        const urlSupabase = 'SUA_URL_SUPABASE_AQUI';
        const chaveSupabase = 'SUA_CHAVE_ANON_AQUI';
        
        // Cliente Supabase
        const clienteSupabase = supabase.createClient(urlSupabase, chaveSupabase);

        // Verifica Login
        async function verificarLogin() {
            const { data, error } = await clienteSupabase.auth.getSession();
            if (!data.session) {
                window.location.href = 'login.html';
            } else {
                document.getElementById('user-display').innerText = data.session.user.email;
            }
        }

        // Função Sair
        async function fazerLogout() {
            await clienteSupabase.auth.signOut();
            window.location.href = 'login.html';
        }

        // Roda verificação ao abrir
        verificarLogin();

        // ==========================================
        // 2. CONFIGURAÇÃO IA E BOTÕES
        // ==========================================

        const API_KEY = "AIzaSyDWpufjH25331yculLeV2zlmzf7sId4Cf4";
        const MODEL = "gemini-3-flash-preview"; 
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;

        // Abrir/Fechar Chat
        function toggleChat() {
            const box = document.getElementById('chat-box');
            box.style.display = box.style.display === 'flex' ? 'none' : 'flex';
        }

        // Preview da Imagem
        let base64Img = null;
        document.getElementById('file-vision').addEventListener('change', function(e){
            const file = e.target.files[0];
            if(file){
                const r = new FileReader();
                r.onload = function(evt){
                    base64Img = evt.target.result.split(',')[1];
                    const img = document.getElementById('img-show');
                    img.src = evt.target.result;
                    img.style.display = 'block';
                }
                r.readAsDataURL(file);
            }
        });

        // Chamada da API (Botões Azuis)
        async function callAPI(type) {
            const resDiv = document.getElementById(`res-${type}`);
            const errDiv = document.getElementById(`err-${type}`);
            
            resDiv.style.display = 'none';
            errDiv.style.display = 'none';
            
            let contents = [];
            
            // Lógica para cada botão
            if (type === 'ads') {
                const prod = document.getElementById('prod-ads').value;
                if(!prod) return alert("Digite o nome do produto.");
                contents = [{ parts: [{ text: `Crie um anúncio profissional para Shopee do produto: ${prod}. Foque em benefícios.` }] }];
            } 
            else if (type === 'vision') {
                if(!base64Img) return alert("Selecione uma imagem.");
                contents = [{ parts: [{ text: "Analise a qualidade desta imagem para e-commerce. Nota 0-10." }, { inline_data: { mime_type: "image/jpeg", data: base64Img } }] }];
            }
            else if (type === 'finance') {
                contents = [{ parts: [{ text: "Dê 3 dicas para reduzir custos operacionais em e-commerce." }] }];
            }

            // Mostra carregando
            resDiv.style.display = 'block';
            resDiv.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando com SmartDesc Ai...';

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: contents })
                });

                const data = await response.json();

                if(data.error) {
                    throw new Error(data.error.message);
                }

                const text = data.candidates[0].content.parts[0].text;
                resDiv.innerHTML = marked.parse(text);

            } catch (error) {
                resDiv.style.display = 'none';
                errDiv.style.display = 'block';
                errDiv.innerHTML = `<strong>Falha na Conexão:</strong> ${
